#include <stdio.h>
#include <stdlib.h>

// découpe la phrase au fur et à mesure et renvoit un char * de la partie découpée

char *strtok(char *str, const char *delim) {
    char * token;       // déclaration du pointeur pour récupérer le 1er mot
    int MAX_SIZE=100;   // on définit la taille max d'un mot à 100 caractères
    static char * s;    // var static (pas réinitialisée si on rappelle strtok)
    const char * d;     // copie du pointeur de delim
    char * t;           // copie du pointeur de token

    token = malloc(MAX_SIZE*sizeof(char));
    if (!token){        // on teste si la création du pointeur s'est bien passée
        fprintf(stderr,"Erreur alloc mémoire");
        exit(EXIT_FAILURE);
    }
    t = token;      // on recopie le pointeur pour pouvoir écrire dans token

    if (str!=NULL) s = str;    // au début on traite str, ensuite s sera traité

    // si str ou delim est NULL return NULL
    //if (!str || !delim || !(*str)) 
    if (!s || !delim || !(*s)) return (char *) NULL;

    // boucle qui permet de supprimer les délimiteurs en début de s sans rien faire d'autre
    while (*s) {        // on parcourt tous les caractères de s jusqu'à la fin s ou break
        d = delim;      // on réinitialise d 
        while (*d) {    // on parcourt tous les caractères de d
            if (*s != *d) d++;      // si le caractère *s n'est pas *d, on passe au suivant
            else break;             // sinon on a trouvé un délimiteur
        }
        if (*d) s++;        // si on a trouvé un délimiteur on avance dans s
        else break;         // sinon on traite s
    }


    while (*s) {    // on parcourt tous les caractères de s jusqu'à la fin de s
        d = delim;  // réinitialistaion du pointeur d 
        while (*d) { // on parcourt tous les caractères de d
            if (*s != *d) d++;      // on passe au caractère suivant
            else break;
        }
        if (*d) {   // si on n'est pas à la fin de d = on a trouve un delimiteur
            *t='\0';    // on met un fin de caractère dans token
            s++;
            break;      // on a fini un mot, on sort de la boucle principale
        } else {    // si on est à la fin de d = le caractère n'est pas un delimiteur
            *t = *s;    // on écrit la lettre courante de s dans token à la bonne pos
            t++;    // on passe au caractère suivant dans token
        }
        s++;        // on passe au caractère suivant
    }
    return token;
}


int main(){
    char ph[] ="  bonjour  a\ttous ";     //avec espace et tab
    char *str =strtok(ph," \t\n");      // la chaine et les separateurs

    while (str != (char *)NULL) {
        printf("%s\n",str);
        str=strtok((char*) NULL," \t\n") ; // la chaine precedente
    }

    return EXIT_SUCCESS;
}
