//  txt.c

#include<stdio.h>
#include"txt.h"
#include <stdlib.h> // malloc
#include<string.h>



//
//  txtCreat
//
// initialise un objet de type txt_t (struct txt_s * ) 
//
struct txt_s *  txtCreat(){
  struct txt_s * res=(struct txt_s *) malloc( sizeof(struct txt_s) );
  res->premier= (struct maillon * ) NULL;
  
  return res;
}


//
//  txtAddStr
//
// ajoute une s lignes en fin du texte
// dans un objet struct txt_s *  
// 
//
void txtAddStr(struct txt_s *   texte,char * ligne){
  // crer un nouveau maillon
  struct maillon * m = (struct maillon *)malloc(sizeof(struct maillon));
  // copie de la chaine
  m->ligne = (char* ) malloc( strlen(ligne)+1);
  strcpy(m->ligne,ligne);

  m->suivant = (struct maillon *) NULL;

  // inserer dans le texte.
  if ( texte->premier == (struct maillon *) NULL){
    // texte vide
    texte->premier = m;
  } else {
    // place a la fin du texte
    struct maillon * p = texte->premier;
     
    while (p->suivant != (struct maillon *) NULL){
      // deplace sur le maillon suivant
      p = p->suivant;
    }
    // p->suivant est  NULL
    p->suivant = m;
  }

}

//
//  txtPrintOut
//  affiche sur la sortie standard
//  les ligned de texte d un objet  struct txt_s *  
//  
//  
void txtPrintOut(struct txt_s *  texte){
  if ( texte != (struct txt_s *)NULL) {	
   struct maillon * p = texte->premier;
  
   while (p != (struct maillon *) NULL){
     // affiche la ligne
     printf("%s\n",p->ligne);
     // deplace sur le maillon suivant
     p = p->suivant;
   }
  }

}

 

struct txt_s * txtCut(struct txt_s *   texte,int deb,int fin){

  return (struct txt_s *) NULL;

}

 
struct txt_s * txtConcat(struct txt_s *   texte,int nb){
    int MAX_SIZE=4096;    // taille maximale
    struct maillon * p = texte->premier;
    struct txt_s * cpTxt = txtCreat(); // copie du texte
    int i=0; // compteur pour arriver jusqu'à nb
    char * newLine = malloc(MAX_SIZE*(sizeof(char)));

    // vérification que le texte n'est pas NULL
    if (texte -> premier == (struct maillon *) NULL) return NULL;

    // on parcourt tous les elements
    while(p->suivant != NULL) {
        // on copie dans newLine la ligne courante
        strcpy(newLine,p->ligne);
        // pour tous les elements suivant inferieur a nb
        for(i=1;i<nb;i++) {
            // on vérifie qu'on est pas au bout de la liste
            if (p->suivant == NULL) break;
            // on concatene avec l'element suivant
            strcat(newLine,p->suivant->ligne);
            // on passe au suivant
            p = p->suivant;
        }
        // on repositionne le pointeur sur le nouveau maillon a traiter
        p = p->suivant;
        // on creer la nouvelle structure dans la copie
        txtAddStr(cpTxt,newLine);
        // si on est au dernier on a fini
        if (p == NULL) break;
    }

    //return (struct txt_s *) NULL;
    return cpTxt;
}

 

 
