/* upper.c
 *   Ecrire une commande upper qui copie le contenu d'un fichier en remplaçant
 *   les lettres minuscules en majuscules. Les noms des fichiers source et
 *   résultat sont passés en argument de la commande. Vous devez pour cela
 *   utiliser les appels système unix (open, read, write, close)
 */  

/*** Voir commentaires détaillés dans upper3.c ***/

#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <unistd.h>
#include <ctype.h>

int main ( int argc , char **argv ) {

    int file,cible; // numero du fichier
    if ( argc != 3 ) { // manque le nom du fichier a traiter
        // message d'erreur
        fprintf(stderr,"usage :  %s source cible \n",argv[0]); 
        exit(1);
    }
    if ((file = open(argv[1],O_RDONLY)) == -1 ){
        // message d'erreur problme d'ouverture du fichier
        //fprintf(stderr,"%s : le fichier %s n'existe pas \n",argv[0],argv[1]);
        perror("upper  open  RDONLY"); // cat: No such file or directory
        exit(errno);
    } 
    if ((cible = open(argv[2],O_WRONLY|O_CREAT|O_TRUNC,0644)) < 0){
        // message d'erreur problme d'ouverture du fichier
        perror("upper open WRONLY "); 
        exit(errno);
    }



    char  c; // caractère
    while ((read(file,&c,1)) > 0) { //lecture dans le fichier c par c
        if (islower(c)) c=toupper(c);
        if (write(cible,&c,1) !=  1) { /* fd = 1 sortie standard */
            perror("upper open write "); 
            exit(errno);
        }
    }
    close(file); //fermeture du fichier
    close(cible);

}
